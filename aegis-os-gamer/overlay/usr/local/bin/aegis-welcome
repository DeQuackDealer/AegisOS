#!/usr/bin/env python3
"""
Aegis OS Welcome Application - Gamer Edition
Displays welcome information and setup options with modern gaming theme
"""

import subprocess
import os
import sys

try:
    import tkinter as tk
    from tkinter import ttk, messagebox
    import webbrowser
    TKINTER_AVAILABLE = True
except ImportError:
    TKINTER_AVAILABLE = False

COLORS = {
    'bg_dark': '#0a0a0f',
    'bg_panel': '#12121a',
    'bg_card': '#1a1a2e',
    'accent_cyan': '#00d4ff',
    'accent_green': '#00ff88',
    'accent_purple': '#8b5cf6',
    'text_primary': '#ffffff',
    'text_secondary': '#a0a0b0',
    'text_muted': '#606070',
    'border': '#2a2a3e',
    'success': '#00ff88',
    'warning': '#ffb800',
    'error': '#ff4757',
}

class AegisWelcome:
    def __init__(self):
        self.root = tk.Tk()
        self.setup_window()
        self.setup_styles()
        self.create_widgets()
        
    def setup_window(self):
        self.root.title("Welcome to Aegis OS Gamer Edition")
        self.root.geometry("900x700")
        self.root.resizable(False, False)
        self.root.configure(bg=COLORS['bg_dark'])
        
        self.root.update_idletasks()
        x = (self.root.winfo_screenwidth() // 2) - (900 // 2)
        y = (self.root.winfo_screenheight() // 2) - (700 // 2)
        self.root.geometry(f"900x700+{x}+{y}")
        
    def setup_styles(self):
        style = ttk.Style()
        style.theme_use('clam')
        
        style.configure('Dark.TFrame', background=COLORS['bg_dark'])
        style.configure('Card.TFrame', background=COLORS['bg_card'])
        style.configure('Panel.TFrame', background=COLORS['bg_panel'])
        
        style.configure('Title.TLabel', 
                       background=COLORS['bg_dark'], 
                       foreground=COLORS['accent_cyan'],
                       font=('Segoe UI', 32, 'bold'))
        
        style.configure('Subtitle.TLabel',
                       background=COLORS['bg_dark'],
                       foreground=COLORS['text_secondary'],
                       font=('Segoe UI', 14))
        
        style.configure('Header.TLabel',
                       background=COLORS['bg_card'],
                       foreground=COLORS['accent_green'],
                       font=('Segoe UI', 16, 'bold'))
        
        style.configure('Feature.TLabel',
                       background=COLORS['bg_card'],
                       foreground=COLORS['text_primary'],
                       font=('Segoe UI', 12))
        
        style.configure('Body.TLabel',
                       background=COLORS['bg_card'],
                       foreground=COLORS['text_secondary'],
                       font=('Segoe UI', 11))
        
        style.configure('Gaming.TButton',
                       font=('Segoe UI', 11, 'bold'),
                       padding=(20, 12))
        
        style.map('Gaming.TButton',
                 background=[('active', COLORS['accent_cyan']), ('!active', COLORS['bg_panel'])],
                 foreground=[('active', COLORS['bg_dark']), ('!active', COLORS['text_primary'])])
        
        style.configure('Accent.TButton',
                       font=('Segoe UI', 11, 'bold'),
                       padding=(20, 12))
        
        style.configure('TCheckbutton',
                       background=COLORS['bg_dark'],
                       foreground=COLORS['text_secondary'],
                       font=('Segoe UI', 10))
        
    def create_card(self, parent, title=None):
        card = tk.Frame(parent, bg=COLORS['bg_card'], 
                       highlightbackground=COLORS['border'],
                       highlightthickness=1)
        
        if title:
            header = tk.Frame(card, bg=COLORS['bg_card'])
            header.pack(fill='x', padx=20, pady=(15, 5))
            
            title_label = tk.Label(header, text=title,
                                  bg=COLORS['bg_card'],
                                  fg=COLORS['accent_green'],
                                  font=('Segoe UI', 14, 'bold'))
            title_label.pack(anchor='w')
            
            separator = tk.Frame(card, bg=COLORS['border'], height=1)
            separator.pack(fill='x', padx=20, pady=(5, 10))
        
        return card
        
    def create_widgets(self):
        main_container = tk.Frame(self.root, bg=COLORS['bg_dark'])
        main_container.pack(fill='both', expand=True, padx=30, pady=25)
        
        header_frame = tk.Frame(main_container, bg=COLORS['bg_dark'])
        header_frame.pack(fill='x', pady=(0, 20))
        
        logo_frame = tk.Frame(header_frame, bg=COLORS['bg_dark'])
        logo_frame.pack()
        
        logo_text = tk.Label(logo_frame, 
                            text="â–² AEGIS OS",
                            bg=COLORS['bg_dark'],
                            fg=COLORS['accent_cyan'],
                            font=('Segoe UI', 36, 'bold'))
        logo_text.pack()
        
        subtitle = tk.Label(header_frame,
                           text="GAMER EDITION  â€¢  The Gold Standard for Gaming",
                           bg=COLORS['bg_dark'],
                           fg=COLORS['text_secondary'],
                           font=('Segoe UI', 13))
        subtitle.pack(pady=(5, 0))
        
        version_badge = tk.Label(header_frame,
                                text="v1.0.0",
                                bg=COLORS['accent_cyan'],
                                fg=COLORS['bg_dark'],
                                font=('Segoe UI', 9, 'bold'),
                                padx=8, pady=2)
        version_badge.pack(pady=(8, 0))
        
        content_frame = tk.Frame(main_container, bg=COLORS['bg_dark'])
        content_frame.pack(fill='both', expand=True)
        
        features_card = self.create_card(content_frame, "âœ¨ What's Included")
        features_card.pack(fill='both', expand=True, pady=(0, 15))
        
        features_content = tk.Frame(features_card, bg=COLORS['bg_card'])
        features_content.pack(fill='both', expand=True, padx=20, pady=(0, 15))
        
        features = [
            ("ğŸ®", "Gaming Optimized", "Pre-configured Proton, Wine, and DXVK for best compatibility"),
            ("âš¡", "High Performance", "Low-latency kernel settings and optimized drivers"),
            ("ğŸ›¡ï¸", "Secure by Design", "Built-in security features without compromising speed"),
            ("ğŸ–¥ï¸", "Lightweight Desktop", "Fast XFCE environment with minimal resource usage"),
            ("ğŸ”§", "Easy Configuration", "Gaming optimizer and performance tuner tools included"),
            ("ğŸ’¬", "Community Support", "Active forums and documentation available"),
        ]
        
        for i, (icon, title, desc) in enumerate(features):
            row = tk.Frame(features_content, bg=COLORS['bg_card'])
            row.pack(fill='x', pady=6)
            
            icon_label = tk.Label(row, text=icon,
                                 bg=COLORS['bg_card'],
                                 fg=COLORS['accent_cyan'],
                                 font=('Segoe UI', 16))
            icon_label.pack(side='left', padx=(0, 12))
            
            text_frame = tk.Frame(row, bg=COLORS['bg_card'])
            text_frame.pack(side='left', fill='x', expand=True)
            
            title_label = tk.Label(text_frame, text=title,
                                  bg=COLORS['bg_card'],
                                  fg=COLORS['text_primary'],
                                  font=('Segoe UI', 11, 'bold'),
                                  anchor='w')
            title_label.pack(fill='x')
            
            desc_label = tk.Label(text_frame, text=desc,
                                 bg=COLORS['bg_card'],
                                 fg=COLORS['text_muted'],
                                 font=('Segoe UI', 10),
                                 anchor='w')
            desc_label.pack(fill='x')
        
        actions_card = self.create_card(content_frame, "ğŸš€ Get Started")
        actions_card.pack(fill='x', pady=(0, 15))
        
        buttons_frame = tk.Frame(actions_card, bg=COLORS['bg_card'])
        buttons_frame.pack(fill='x', padx=20, pady=(0, 15))
        
        buttons = [
            ("ğŸ“Š System Info", self.show_system_info, COLORS['accent_cyan']),
            ("ğŸ® Gaming Setup", self.launch_gaming_setup, COLORS['accent_green']),
            ("ğŸ’¬ Community", self.open_community, COLORS['accent_purple']),
        ]
        
        for text, command, color in buttons:
            btn = tk.Button(buttons_frame, text=text,
                           command=command,
                           bg=COLORS['bg_panel'],
                           fg=COLORS['text_primary'],
                           activebackground=color,
                           activeforeground=COLORS['bg_dark'],
                           font=('Segoe UI', 11, 'bold'),
                           bd=0,
                           padx=25, pady=12,
                           cursor='hand2',
                           highlightthickness=1,
                           highlightbackground=color)
            btn.pack(side='left', padx=(0, 10))
            
            btn.bind('<Enter>', lambda e, b=btn, c=color: b.configure(bg=c, fg=COLORS['bg_dark']))
            btn.bind('<Leave>', lambda e, b=btn: b.configure(bg=COLORS['bg_panel'], fg=COLORS['text_primary']))
        
        upgrade_frame = tk.Frame(content_frame, bg=COLORS['bg_panel'],
                                highlightbackground=COLORS['accent_purple'],
                                highlightthickness=1)
        upgrade_frame.pack(fill='x', pady=(0, 15))
        
        upgrade_content = tk.Frame(upgrade_frame, bg=COLORS['bg_panel'])
        upgrade_content.pack(fill='x', padx=20, pady=15)
        
        upgrade_icon = tk.Label(upgrade_content, text="ğŸ’",
                               bg=COLORS['bg_panel'],
                               font=('Segoe UI', 20))
        upgrade_icon.pack(side='left', padx=(0, 15))
        
        upgrade_text_frame = tk.Frame(upgrade_content, bg=COLORS['bg_panel'])
        upgrade_text_frame.pack(side='left', fill='x', expand=True)
        
        upgrade_title = tk.Label(upgrade_text_frame, 
                                text="Explore Other Editions",
                                bg=COLORS['bg_panel'],
                                fg=COLORS['text_primary'],
                                font=('Segoe UI', 12, 'bold'),
                                anchor='w')
        upgrade_title.pack(fill='x')
        
        upgrade_desc = tk.Label(upgrade_text_frame,
                               text="Server, AI-Dev, and Enterprise editions available",
                               bg=COLORS['bg_panel'],
                               fg=COLORS['text_muted'],
                               font=('Segoe UI', 10),
                               anchor='w')
        upgrade_desc.pack(fill='x')
        
        upgrade_btn = tk.Button(upgrade_content, text="View All â†’",
                               command=self.open_upgrade_info,
                               bg=COLORS['accent_purple'],
                               fg=COLORS['text_primary'],
                               activebackground=COLORS['text_primary'],
                               activeforeground=COLORS['accent_purple'],
                               font=('Segoe UI', 10, 'bold'),
                               bd=0,
                               padx=15, pady=8,
                               cursor='hand2')
        upgrade_btn.pack(side='right')
        
        footer_frame = tk.Frame(main_container, bg=COLORS['bg_dark'])
        footer_frame.pack(fill='x')
        
        close_btn = tk.Button(footer_frame, text="Start Using Aegis OS",
                             command=self.root.destroy,
                             bg=COLORS['accent_cyan'],
                             fg=COLORS['bg_dark'],
                             activebackground=COLORS['text_primary'],
                             activeforeground=COLORS['bg_dark'],
                             font=('Segoe UI', 12, 'bold'),
                             bd=0,
                             padx=30, pady=12,
                             cursor='hand2')
        close_btn.pack(pady=(0, 10))
        
        self.show_again_var = tk.BooleanVar(value=True)
        show_again_cb = tk.Checkbutton(footer_frame,
                                       text="Show this welcome screen on startup",
                                       variable=self.show_again_var,
                                       command=self.toggle_autostart,
                                       bg=COLORS['bg_dark'],
                                       fg=COLORS['text_muted'],
                                       selectcolor=COLORS['bg_panel'],
                                       activebackground=COLORS['bg_dark'],
                                       activeforeground=COLORS['text_secondary'],
                                       font=('Segoe UI', 10),
                                       cursor='hand2')
        show_again_cb.pack()
        
    def show_system_info(self):
        try:
            result = subprocess.run(["/usr/local/bin/aegis-system-info"], 
                                  capture_output=True, text=True, timeout=30)
            
            info_window = tk.Toplevel(self.root)
            info_window.title("System Information")
            info_window.geometry("700x550")
            info_window.configure(bg=COLORS['bg_dark'])
            
            header = tk.Label(info_window, text="ğŸ“Š System Information",
                             bg=COLORS['bg_dark'],
                             fg=COLORS['accent_cyan'],
                             font=('Segoe UI', 18, 'bold'))
            header.pack(pady=15)
            
            text_frame = tk.Frame(info_window, bg=COLORS['bg_card'],
                                 highlightbackground=COLORS['border'],
                                 highlightthickness=1)
            text_frame.pack(fill='both', expand=True, padx=20, pady=(0, 20))
            
            text_widget = tk.Text(text_frame, 
                                 font=('Consolas', 10),
                                 bg=COLORS['bg_card'],
                                 fg=COLORS['accent_green'],
                                 insertbackground=COLORS['text_primary'],
                                 selectbackground=COLORS['accent_cyan'],
                                 selectforeground=COLORS['bg_dark'],
                                 bd=0,
                                 padx=15, pady=15)
            text_widget.pack(fill='both', expand=True)
            
            scrollbar = tk.Scrollbar(text_widget, command=text_widget.yview)
            scrollbar.pack(side='right', fill='y')
            text_widget.config(yscrollcommand=scrollbar.set)
            
            text_widget.insert('1.0', result.stdout if result.stdout else "Unable to retrieve system information")
            text_widget.config(state='disabled')
            
        except subprocess.TimeoutExpired:
            messagebox.showerror("Error", "System information command timed out")
        except Exception as e:
            messagebox.showerror("Error", f"Failed to get system information: {e}")
    
    def launch_gaming_setup(self):
        try:
            subprocess.run(["/usr/local/bin/aegis-gaming-optimizer"], check=True, timeout=60)
            messagebox.showinfo("Success", "Gaming optimizations have been applied!")
        except subprocess.TimeoutExpired:
            messagebox.showerror("Error", "Gaming setup timed out")
        except Exception as e:
            messagebox.showerror("Error", f"Gaming setup failed: {e}")
    
    def open_community(self):
        webbrowser.open("https://community.aegis-os.com")
    
    def open_upgrade_info(self):
        webbrowser.open("https://aegis-os.com/editions")
    
    def toggle_autostart(self):
        autostart_dir = os.path.expanduser("~/.config/autostart")
        autostart_file = os.path.join(autostart_dir, "aegis-welcome.desktop")
        
        try:
            if self.show_again_var.get():
                os.makedirs(autostart_dir, exist_ok=True)
                desktop_content = """[Desktop Entry]
Type=Application
Name=Aegis Welcome
Exec=/usr/local/bin/aegis-welcome
Hidden=false
NoDisplay=false
X-GNOME-Autostart-enabled=true
"""
                with open(autostart_file, 'w') as f:
                    f.write(desktop_content)
            else:
                if os.path.exists(autostart_file):
                    os.remove(autostart_file)
        except (OSError, PermissionError) as e:
            pass
    
    def run(self):
        self.root.mainloop()

def show_cli_welcome():
    print("""
\033[96mâ•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                â•‘
â•‘     â–² AEGIS OS                                                 â•‘
â•‘     GAMER EDITION                                              â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\033[0m

    \033[36mâ–„â–€â–ˆ â–ˆâ–€â–€ â–ˆâ–€â–€ â–ˆ â–ˆâ–€   â–ˆâ–€â–ˆ â–ˆâ–€
    â–ˆâ–€â–ˆ â–ˆâ–ˆâ–„ â–ˆâ–„â–ˆ â–ˆ â–„â–ˆ   â–ˆâ–„â–ˆ â–„â–ˆ\033[0m
    
\033[93mThe Gold Standard for Gaming\033[0m

\033[92mâœ¨ WHAT'S INCLUDED:\033[0m
  âœ… Gaming Optimized - Pre-configured Proton, Wine, and DXVK
  âœ… High Performance - Low-latency kernel settings
  âœ… Secure by Design - Built-in security features
  âœ… Lightweight XFCE desktop environment
  âœ… Essential system utilities and optimization tools
  âœ… Community support and forums access

\033[96mğŸš€ QUICK START COMMANDS:\033[0m
  â€¢ System Information : aegis-system-info
  â€¢ Gaming Optimizer   : aegis-gaming-optimizer
  â€¢ System Monitor     : aegis-system-monitor
  â€¢ Security Center    : aegis-security-center

\033[95mğŸ’¬ COMMUNITY & SUPPORT:\033[0m
  â€¢ Forums    : https://community.aegis-os.com
  â€¢ Wiki      : https://wiki.aegis-os.com
  â€¢ Editions  : https://aegis-os.com/editions

\033[90mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\033[0m
""")

if __name__ == "__main__":
    if TKINTER_AVAILABLE:
        try:
            app = AegisWelcome()
            app.run()
        except Exception as e:
            print(f"GUI failed: {e}")
            show_cli_welcome()
    else:
        show_cli_welcome()
