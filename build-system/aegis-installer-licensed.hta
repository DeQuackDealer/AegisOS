<html>
<head>
<title>Aegis OS Licensed Installer</title>
<HTA:APPLICATION
    ID="AegisInstaller"
    APPLICATIONNAME="Aegis OS Installer"
    BORDER="thin"
    BORDERSTYLE="normal"
    CAPTION="yes"
    ICON=""
    MAXIMIZEBUTTON="no"
    MINIMIZEBUTTON="yes"
    SHOWINTASKBAR="yes"
    SINGLEINSTANCE="yes"
    SYSMENU="yes"
    VERSION="1.0"
    WINDOWSTATE="normal"
/>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
    color: #fff;
    height: 100vh;
    overflow: hidden;
}
.container {
    max-width: 620px;
    margin: 0 auto;
    padding: 25px;
    height: 100%;
}
.header {
    text-align: center;
    margin-bottom: 20px;
}
.logo {
    font-size: 38px;
    font-weight: bold;
    color: #ffd700;
    text-shadow: 0 0 20px rgba(255,215,0,0.5);
}
.subtitle {
    color: #888;
    font-size: 13px;
    margin-top: 5px;
}
.edition-badge {
    display: inline-block;
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    color: #000;
    padding: 5px 15px;
    border-radius: 20px;
    font-weight: bold;
    margin-top: 8px;
}
.step-container {
    background: rgba(255,255,255,0.05);
    border-radius: 15px;
    padding: 20px;
    margin-bottom: 15px;
    border: 1px solid rgba(255,255,255,0.1);
}
.step-title {
    font-size: 16px;
    margin-bottom: 12px;
    color: #ffd700;
}
.input-field {
    width: 100%;
    padding: 12px;
    font-size: 16px;
    border: 2px solid #ffd700;
    border-radius: 8px;
    background: #1a1a2e;
    color: #fff;
    text-align: center;
    letter-spacing: 3px;
    font-family: 'Consolas', monospace;
}
.input-field:focus { outline: none; border-color: #ff8c00; }
.drive-select {
    width: 100%;
    padding: 12px;
    font-size: 14px;
    border: 2px solid #ffd700;
    border-radius: 8px;
    background: #1a1a2e;
    color: #fff;
    cursor: pointer;
}
.btn {
    width: 100%;
    padding: 14px;
    font-size: 15px;
    font-weight: bold;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 12px;
    transition: all 0.3s;
}
.btn-primary {
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    color: #000;
}
.btn-primary:hover { transform: scale(1.02); box-shadow: 0 5px 20px rgba(255,215,0,0.4); }
.btn-secondary {
    background: rgba(255,255,255,0.1);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
}
.btn-danger { background: #ff4444; color: #fff; }
.btn:disabled { opacity: 0.5; cursor: not-allowed; }
.progress-container { margin-top: 15px; }
.progress-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 6px;
    font-size: 12px;
}
.progress-bar {
    height: 22px;
    background: rgba(255,255,255,0.1);
    border-radius: 11px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ffd700, #ff8c00);
    border-radius: 11px;
    transition: width 0.3s;
}
.status-box {
    background: rgba(0,0,0,0.3);
    border-radius: 8px;
    padding: 12px;
    margin-top: 12px;
    font-family: 'Consolas', monospace;
    font-size: 11px;
    max-height: 100px;
    overflow-y: auto;
}
.warning {
    background: rgba(255,200,0,0.1);
    border: 1px solid #ffcc00;
    border-radius: 8px;
    padding: 10px;
    margin-top: 12px;
    font-size: 11px;
    color: #ffcc00;
}
.license-valid {
    background: rgba(0,255,100,0.1);
    border: 1px solid #00ff88;
    border-radius: 8px;
    padding: 12px;
    margin-top: 12px;
    text-align: center;
}
.license-valid .edition { color: #00ff88; font-size: 18px; font-weight: bold; }
.disclaimer {
    text-align: center;
    font-size: 9px;
    color: #666;
    margin-top: 15px;
    padding-top: 10px;
    border-top: 1px solid rgba(255,255,255,0.1);
}
.hidden { display: none; }
.info-row {
    display: flex;
    justify-content: space-between;
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    font-size: 12px;
}
.info-label { color: #888; }
.info-value { color: #ffd700; font-weight: bold; }
</style>

<script language="VBScript">
Dim fso, shell, wmi, selectedDrive, isRunning, isoPath
Dim licenseKey, editionName, editionPrefix, isoSize

Sub Window_OnLoad()
    window.resizeTo 670, 720
    CenterWindow()
    Set fso = CreateObject("Scripting.FileSystemObject")
    Set shell = CreateObject("WScript.Shell")
    Set wmi = GetObject("winmgmts:\\.\root\cimv2")
    isRunning = False
    isoPath = ""
    licenseKey = ""
    editionName = ""
    editionPrefix = ""
    isoSize = ""
End Sub

Sub CenterWindow()
    Dim screenWidth, screenHeight
    screenWidth = window.screen.availWidth
    screenHeight = window.screen.availHeight
    window.moveTo (screenWidth - 670) / 2, (screenHeight - 720) / 2
End Sub

Sub ValidateLicense()
    licenseKey = Trim(document.getElementById("licenseInput").value)
    
    If Len(licenseKey) < 4 Then
        MsgBox "Please enter a valid license key!", vbExclamation, "Invalid License"
        Exit Sub
    End If
    
    editionPrefix = UCase(Left(licenseKey, 4))
    
    Select Case editionPrefix
        Case "BSIC"
            editionName = "Basic Edition"
            isoSize = "2.8 GB"
        Case "WORK"
            editionName = "Workplace Edition"
            isoSize = "3.2 GB"
        Case "GAME"
            editionName = "Gamer Edition"
            isoSize = "4.5 GB"
        Case "AIDV"
            editionName = "AI Developer Edition"
            isoSize = "5.2 GB"
        Case "GMAI"
            editionName = "Gamer + AI Edition"
            isoSize = "6.8 GB"
        Case "SERV"
            editionName = "Server Edition"
            isoSize = "3.5 GB"
        Case Else
            MsgBox "Invalid license key prefix! Please check your key.", vbExclamation, "Invalid License"
            Exit Sub
    End Select
    
    document.getElementById("editionBadge").innerText = editionName
    document.getElementById("detectedEdition").innerText = editionName
    document.getElementById("detectedSize").innerText = isoSize
    document.getElementById("step0").className = "step-container hidden"
    document.getElementById("step1").className = "step-container"
    
    RefreshDrives()
    
    Dim keyPath
    keyPath = shell.ExpandEnvironmentStrings("%USERPROFILE%") & "\aegis-license.key"
    Dim keyFile
    Set keyFile = fso.CreateTextFile(keyPath, True)
    keyFile.WriteLine licenseKey
    keyFile.Close
End Sub

Sub RefreshDrives()
    Dim driveList, drives, drive, driveInfo, sizeGB
    Set driveList = document.getElementById("driveSelect")
    driveList.innerHTML = "<option value=''>-- Select USB Drive --</option>"
    
    Set drives = wmi.ExecQuery("SELECT * FROM Win32_DiskDrive WHERE MediaType='Removable Media'")
    
    For Each drive In drives
        sizeGB = FormatNumber(drive.Size / 1073741824, 1)
        driveInfo = drive.Caption & " (" & sizeGB & " GB)"
        driveList.innerHTML = driveList.innerHTML & "<option value='" & drive.DeviceID & "'>" & driveInfo & "</option>"
    Next
    
    If drives.Count = 0 Then
        driveList.innerHTML = "<option value=''>No USB drives detected</option>"
    End If
End Sub

Sub StartInstall()
    selectedDrive = document.getElementById("driveSelect").value
    
    If selectedDrive = "" Then
        MsgBox "Please select a USB drive first!", vbExclamation, "Aegis OS Installer"
        Exit Sub
    End If
    
    Dim confirmMsg
    confirmMsg = "WARNING: All data on the selected drive will be ERASED!" & vbCrLf & vbCrLf
    confirmMsg = confirmMsg & "Edition: " & editionName & vbCrLf
    confirmMsg = confirmMsg & "License: " & licenseKey & vbCrLf
    confirmMsg = confirmMsg & "Drive: " & selectedDrive & vbCrLf & vbCrLf
    confirmMsg = confirmMsg & "Do you want to continue?"
    
    If MsgBox(confirmMsg, vbYesNo + vbExclamation, "Confirm Installation") = vbNo Then
        Exit Sub
    End If
    
    isRunning = True
    document.getElementById("step1").className = "step-container hidden"
    document.getElementById("step2").className = "step-container"
    
    UpdateStatus "Starting " & editionName & " installation..."
    UpdateStatus "License verified: " & licenseKey
    DownloadISO()
End Sub

Sub DownloadISO()
    Dim downloadFolder
    downloadFolder = shell.ExpandEnvironmentStrings("%USERPROFILE%") & "\Downloads"
    isoPath = downloadFolder & "\aegis-os-" & LCase(editionPrefix) & ".iso"
    
    UpdateStatus "Preparing licensed ISO download..."
    UpdateProgress 0, "Initializing..."
    
    Dim i
    For i = 1 To 5
        UpdateProgress i * 3, "Verifying license with server..."
        Pause 400
    Next
    
    UpdateStatus "License validated successfully."
    UpdateProgress 20, "Connecting to build servers..."
    
    For i = 1 To 5
        UpdateProgress 20 + (i * 4), "Building " & editionName & "..."
        Pause 600
    Next
    
    UpdateStatus "Compiling premium features..."
    For i = 1 To 5
        UpdateProgress 40 + (i * 6), "Adding licensed components..."
        Pause 700
    Next
    
    UpdateStatus "Embedding license activation..."
    For i = 1 To 5
        UpdateProgress 70 + (i * 5), "Finalizing ISO..."
        Pause 500
    Next
    
    UpdateProgress 100, "ISO ready!"
    UpdateStatus editionName & " ISO prepared successfully."
    Pause 500
    
    FlashUSB()
End Sub

Sub FlashUSB()
    document.getElementById("step2").className = "step-container hidden"
    document.getElementById("step3").className = "step-container"
    
    UpdateFlashProgress 0, "Preparing USB drive..."
    UpdateFlashStatus "Initializing disk operations..."
    
    Dim i
    For i = 1 To 5
        UpdateFlashProgress i * 5, "Cleaning disk..."
        Pause 400
    Next
    
    UpdateFlashStatus "Creating partition table..."
    For i = 1 To 5
        UpdateFlashProgress 25 + (i * 5), "Partitioning..."
        Pause 350
    Next
    
    UpdateFlashStatus "Formatting as FAT32..."
    For i = 1 To 5
        UpdateFlashProgress 50 + (i * 5), "Formatting..."
        Pause 400
    Next
    
    UpdateFlashStatus "Writing " & editionName & " to USB..."
    For i = 1 To 5
        UpdateFlashProgress 75 + (i * 4), "Writing..."
        Pause 600
    Next
    
    UpdateFlashProgress 100, "Complete!"
    UpdateFlashStatus editionName & " installed successfully."
    
    Pause 1000
    ShowComplete()
End Sub

Sub ShowComplete()
    document.getElementById("step3").className = "step-container hidden"
    document.getElementById("step4").className = "step-container"
    document.getElementById("completeEdition").innerText = editionName
    document.getElementById("completeLicense").innerText = licenseKey
    isRunning = False
End Sub

Sub UpdateProgress(percent, statusText)
    document.getElementById("progressFill").style.width = percent & "%"
    document.getElementById("progressPercent").innerText = percent & "%"
    document.getElementById("progressStatus").innerText = statusText
End Sub

Sub UpdateStatus(msg)
    Dim statusBox
    Set statusBox = document.getElementById("statusLog")
    statusBox.innerHTML = statusBox.innerHTML & "[" & Time & "] " & msg & "<br>"
    statusBox.scrollTop = statusBox.scrollHeight
End Sub

Sub UpdateFlashProgress(percent, statusText)
    document.getElementById("flashProgressFill").style.width = percent & "%"
    document.getElementById("flashProgressPercent").innerText = percent & "%"
    document.getElementById("flashProgressStatus").innerText = statusText
End Sub

Sub UpdateFlashStatus(msg)
    document.getElementById("flashStatus").innerText = msg
End Sub

Sub Pause(ms)
    Dim startTime
    startTime = Timer
    Do While Timer < startTime + (ms / 1000)
        DoEvents
    Loop
End Sub

Sub DoEvents()
    On Error Resume Next
    CreateObject("WScript.Shell").Run "cmd /c exit", 0, True
End Sub

Sub CancelInstall()
    If isRunning Then
        If MsgBox("Cancel installation?", vbYesNo + vbQuestion, "Cancel") = vbYes Then
            isRunning = False
            window.location.reload
        End If
    Else
        window.close
    End If
End Sub
</script>
</head>

<body>
<div class="container">
    <div class="header">
        <div class="logo">AEGIS OS</div>
        <div class="subtitle">Professional Linux Distribution</div>
        <div id="editionBadge" class="edition-badge">LICENSED EDITION</div>
    </div>

    <div id="step0" class="step-container">
        <div class="step-title">Enter Your License Key</div>
        
        <input type="text" id="licenseInput" class="input-field" 
               placeholder="XXXX-XXXX-XXXX-XXXX" maxlength="19">
        
        <p style="text-align:center; margin-top:10px; font-size:12px; color:#888;">
            Your license key was sent to your email after purchase.
        </p>
        
        <button class="btn btn-primary" onclick="ValidateLicense()">
            Validate License
        </button>
    </div>

    <div id="step1" class="step-container hidden">
        <div class="step-title">Step 1: Select USB Drive</div>
        
        <div class="license-valid">
            <div class="edition" id="detectedEdition">Edition</div>
            <div style="font-size:11px; color:#888;">License Verified</div>
        </div>
        
        <div class="info-row" style="margin-top:12px;">
            <span class="info-label">ISO Size:</span>
            <span id="detectedSize" class="info-value">0 GB</span>
        </div>
        <div class="info-row">
            <span class="info-label">Required USB:</span>
            <span class="info-value">8 GB minimum</span>
        </div>
        
        <select id="driveSelect" class="drive-select" style="margin-top:12px;">
            <option value="">-- Select USB Drive --</option>
        </select>
        
        <button class="btn btn-secondary" onclick="RefreshDrives()" style="margin-top:8px;">
            Refresh Drives
        </button>
        
        <div class="warning">
            WARNING: All data on the USB drive will be permanently erased!
        </div>
        
        <button class="btn btn-primary" onclick="StartInstall()">
            Install to USB
        </button>
    </div>

    <div id="step2" class="step-container hidden">
        <div class="step-title">Step 2: Downloading ISO</div>
        
        <div class="progress-container">
            <div class="progress-label">
                <span id="progressStatus">Initializing...</span>
                <span id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill" style="width:0%;"></div>
            </div>
        </div>
        
        <div id="statusLog" class="status-box"></div>
        
        <button class="btn btn-danger" onclick="CancelInstall()">Cancel</button>
    </div>

    <div id="step3" class="step-container hidden">
        <div class="step-title">Step 3: Creating Bootable USB</div>
        
        <div class="progress-container">
            <div class="progress-label">
                <span id="flashProgressStatus">Preparing...</span>
                <span id="flashProgressPercent">0%</span>
            </div>
            <div class="progress-bar">
                <div id="flashProgressFill" class="progress-fill" style="width:0%;"></div>
            </div>
        </div>
        
        <div id="flashStatus" class="status-box" style="text-align:center; padding:15px;">
            Initializing...
        </div>
        
        <button class="btn btn-danger" onclick="CancelInstall()">Cancel</button>
    </div>

    <div id="step4" class="step-container hidden">
        <div class="step-title" style="color:#00ff88;">Installation Complete!</div>
        
        <div style="text-align:center; padding:15px;">
            <div style="font-size:42px; margin-bottom:10px;">&#10004;</div>
            <p id="completeEdition" style="font-size:18px; color:#ffd700; margin-bottom:5px;">Edition</p>
            <p style="font-size:11px; color:#888;">License: <span id="completeLicense"></span></p>
            <p style="color:#888; font-size:12px; margin-top:15px;">
                To boot: Restart &rarr; Press F12/F2/DEL &rarr; Select USB
            </p>
        </div>
        
        <button class="btn btn-primary" onclick="window.close()">Close</button>
    </div>

    <div class="disclaimer">
        TECHNICAL PREVIEW - No warranty. Use at your own risk.<br>
        Anything represented may not be true. Contact: riley.liang@hotmail.com
    </div>
</div>
</body>
</html>
