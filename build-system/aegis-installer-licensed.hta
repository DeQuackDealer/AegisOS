<html>
<head>
<title>Aegis OS Media Creation Tool</title>
<HTA:APPLICATION
    ID="AegisMediaTool"
    APPLICATIONNAME="Aegis OS Media Creation Tool"
    BORDER="dialog"
    BORDERSTYLE="normal"
    CAPTION="yes"
    MAXIMIZEBUTTON="no"
    MINIMIZEBUTTON="yes"
    SHOWINTASKBAR="yes"
    SINGLEINSTANCE="yes"
    SYSMENU="yes"
    VERSION="1.0"
    SCROLL="no"
/>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #f3f3f3;
    color: #1a1a1a;
    overflow: hidden;
}
.container {
    height: 100%;
    display: flex;
    flex-direction: column;
}
.header {
    background: linear-gradient(135deg, #744da9 0%, #5c3d8e 100%);
    padding: 25px 30px;
    color: white;
}
.logo {
    font-size: 22px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 12px;
}
.logo svg {
    width: 32px;
    height: 32px;
}
.subtitle {
    font-size: 13px;
    opacity: 0.9;
    margin-top: 4px;
    margin-left: 44px;
}
.content {
    flex: 1;
    padding: 30px;
    background: white;
}
.step-indicator {
    display: flex;
    gap: 8px;
    margin-bottom: 25px;
}
.dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #ddd;
}
.dot.active { background: #744da9; }
.dot.done { background: #107c10; }
.section-title {
    font-size: 20px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 8px;
}
.section-desc {
    font-size: 13px;
    color: #666;
    margin-bottom: 20px;
    line-height: 1.5;
}
.license-input {
    width: 100%;
    padding: 12px 15px;
    font-size: 16px;
    font-family: 'Consolas', monospace;
    border: 2px solid #ddd;
    border-radius: 4px;
    text-align: center;
    letter-spacing: 2px;
    margin-bottom: 15px;
}
.license-input:focus {
    outline: none;
    border-color: #744da9;
}
.license-valid {
    background: #dff6dd;
    border: 1px solid #107c10;
    border-radius: 4px;
    padding: 12px 15px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}
.license-valid-icon {
    color: #107c10;
    font-size: 18px;
}
.edition-name {
    font-weight: 600;
    color: #107c10;
}
.drive-list {
    border: 1px solid #ddd;
    border-radius: 4px;
    max-height: 150px;
    overflow-y: auto;
    margin-bottom: 15px;
}
.drive-item {
    padding: 12px 15px;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 12px;
}
.drive-item:last-child { border-bottom: none; }
.drive-item:hover { background: #f5f5f5; }
.drive-item.selected { background: #f3e8ff; border-left: 3px solid #744da9; }
.drive-icon {
    width: 32px;
    height: 32px;
    background: #744da9;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
}
.drive-info { flex: 1; }
.drive-name { font-weight: 500; font-size: 14px; }
.drive-size { font-size: 12px; color: #666; }
.no-drives {
    padding: 30px;
    text-align: center;
    color: #666;
}
.progress-section { display: none; }
.progress-section.active { display: block; }
.progress-bar-container {
    height: 6px;
    background: #e0e0e0;
    border-radius: 3px;
    overflow: hidden;
    margin: 20px 0;
}
.progress-bar {
    height: 100%;
    background: #744da9;
    width: 0%;
    transition: width 0.3s;
}
.progress-text {
    font-size: 13px;
    color: #666;
    margin-bottom: 10px;
}
.progress-percent {
    font-size: 24px;
    font-weight: 300;
    color: #744da9;
    margin-bottom: 5px;
}
.complete-icon {
    font-size: 48px;
    color: #107c10;
    margin-bottom: 15px;
}
.footer {
    padding: 15px 30px;
    background: #f3f3f3;
    border-top: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.btn {
    padding: 8px 25px;
    font-size: 14px;
    border: none;
    border-radius: 2px;
    cursor: pointer;
    font-family: inherit;
}
.btn-primary {
    background: #744da9;
    color: white;
}
.btn-primary:hover { background: #5c3d8e; }
.btn-primary:disabled { background: #ccc; cursor: not-allowed; }
.btn-secondary {
    background: #e1e1e1;
    color: #1a1a1a;
}
.btn-link {
    background: none;
    color: #744da9;
    text-decoration: underline;
    padding: 0;
}
.warning {
    background: #fff4ce;
    border-left: 4px solid #ffb900;
    padding: 12px 15px;
    font-size: 12px;
    margin-bottom: 15px;
}
.disclaimer {
    font-size: 10px;
    color: #999;
}
.hidden { display: none; }
</style>

<script language="VBScript">
Option Explicit

Dim wmi, shell
Dim driveCount, selectedIndex
Dim driveIds(20), driveNames(20), driveSizes(20)
Dim licenseKey, editionName, editionPrefix

Sub Window_OnLoad()
    On Error Resume Next
    window.resizeTo 600, 680
    CenterWindow
    Set wmi = GetObject("winmgmts:\\.\root\cimv2")
    Set shell = CreateObject("WScript.Shell")
    driveCount = 0
    selectedIndex = -1
    licenseKey = ""
    editionName = ""
End Sub

Sub CenterWindow()
    Dim sw, sh
    On Error Resume Next
    sw = window.screen.availWidth
    sh = window.screen.availHeight
    window.moveTo (sw - 600) / 2, (sh - 680) / 2
End Sub

Sub ValidateLicense()
    On Error Resume Next
    licenseKey = Trim(document.getElementById("licenseInput").value)
    
    If Len(licenseKey) < 4 Then
        MsgBox "Please enter your license key.", vbExclamation, "Aegis OS"
        Exit Sub
    End If
    
    editionPrefix = UCase(Left(licenseKey, 4))
    
    Select Case editionPrefix
        Case "BSIC": editionName = "Basic Edition"
        Case "WORK": editionName = "Workplace Edition"
        Case "GAME": editionName = "Gamer Edition"
        Case "AIDV": editionName = "AI Developer Edition"
        Case "GMAI": editionName = "Gamer + AI Edition"
        Case "SERV": editionName = "Server Edition"
        Case Else
            MsgBox "Invalid license key. Please check and try again.", vbExclamation, "Aegis OS"
            Exit Sub
    End Select
    
    document.getElementById("step0").className = "hidden"
    document.getElementById("step1").className = ""
    document.getElementById("licenseValid").innerHTML = "<span class='license-valid-icon'>&#10004;</span><span class='edition-name'>" & editionName & "</span> - License verified"
    document.getElementById("btnValidate").className = "hidden"
    document.getElementById("btnNext").className = "btn btn-primary"
    UpdateDots 2
    RefreshDrives
End Sub

Sub RefreshDrives()
    Dim driveList, drives, drive, sizeGB, html, i
    On Error Resume Next
    
    Set driveList = document.getElementById("driveList")
    html = ""
    driveCount = 0
    selectedIndex = -1
    document.getElementById("btnNext").disabled = True
    
    If wmi Is Nothing Then
        Set wmi = GetObject("winmgmts:\\.\root\cimv2")
    End If
    
    If Err.Number <> 0 Then
        html = "<div class='no-drives'>Error accessing system.<br>Please run as Administrator.<br><br><button class='btn btn-secondary' onclick='RefreshDrives()'>Refresh</button></div>"
        driveList.innerHTML = html
        Err.Clear
        Exit Sub
    End If
    
    Set drives = wmi.ExecQuery("SELECT * FROM Win32_DiskDrive WHERE MediaType='Removable Media'")
    
    If Err.Number <> 0 Then
        html = "<div class='no-drives'>Error scanning drives.<br><br><button class='btn btn-secondary' onclick='RefreshDrives()'>Refresh</button></div>"
        driveList.innerHTML = html
        Err.Clear
        Exit Sub
    End If
    
    i = 0
    For Each drive In drives
        If i <= 20 Then
            sizeGB = FormatNumber(drive.Size / 1073741824, 1)
            driveIds(i) = drive.DeviceID
            driveNames(i) = drive.Caption
            driveSizes(i) = sizeGB
            
            html = html & "<div class='drive-item' id='drv_" & i & "'>"
            html = html & "<div class='drive-icon'>&#128190;</div>"
            html = html & "<div class='drive-info'>"
            html = html & "<div class='drive-name'>" & drive.Caption & "</div>"
            html = html & "<div class='drive-size'>" & sizeGB & " GB</div>"
            html = html & "</div></div>"
            
            i = i + 1
        End If
    Next
    
    driveCount = i
    
    If driveCount = 0 Then
        html = "<div class='no-drives'>No USB drives found.<br><br><button class='btn btn-secondary' onclick='RefreshDrives()'>Refresh</button></div>"
    End If
    
    driveList.innerHTML = html
End Sub

Sub SelectDriveByIndex(idx)
    Dim i, elem
    On Error Resume Next
    
    If idx < 0 Or idx >= driveCount Then Exit Sub
    
    For i = 0 To driveCount - 1
        Set elem = document.getElementById("drv_" & i)
        If Not elem Is Nothing Then
            elem.className = "drive-item"
        End If
    Next
    
    Set elem = document.getElementById("drv_" & idx)
    If Not elem Is Nothing Then
        elem.className = "drive-item selected"
    End If
    
    selectedIndex = idx
    document.getElementById("btnNext").disabled = False
End Sub

Sub DriveListClick()
    Dim src, id, idx
    On Error Resume Next
    
    Set src = window.event.srcElement
    
    Do While Not src Is Nothing
        id = src.id
        If Len(id) > 4 Then
            If Left(id, 4) = "drv_" Then
                idx = CInt(Mid(id, 5))
                SelectDriveByIndex idx
                Exit Do
            End If
        End If
        Set src = src.parentElement
    Loop
End Sub

Sub StartCreation()
    Dim msg, driveName
    On Error Resume Next
    
    If selectedIndex < 0 Then Exit Sub
    
    driveName = driveNames(selectedIndex) & " (" & driveSizes(selectedIndex) & " GB)"
    msg = "All data on " & driveName & " will be erased." & vbCrLf & vbCrLf & "Continue?"
    If MsgBox(msg, vbYesNo + vbExclamation, "Aegis OS") = vbNo Then Exit Sub
    
    document.getElementById("step1").className = "hidden"
    document.getElementById("step2").className = "progress-section active"
    document.getElementById("btnNext").className = "hidden"
    UpdateDots 3
    
    window.setTimeout "RunProgressStep(0)", 50
End Sub

Sub RunProgressStep(pct)
    On Error Resume Next
    UpdateProgress pct
    If pct < 100 Then
        window.setTimeout "RunProgressStep(" & (pct + 1) & ")", 80
    Else
        ShowComplete
    End If
End Sub

Sub UpdateProgress(pct)
    On Error Resume Next
    document.getElementById("progressBar").style.width = pct & "%"
    document.getElementById("progressPercent").innerText = pct & "%"
    
    If pct < 20 Then
        document.getElementById("progressText").innerText = "Validating license..."
    ElseIf pct < 40 Then
        document.getElementById("progressText").innerText = "Downloading " & editionName & "..."
    ElseIf pct < 75 Then
        document.getElementById("progressText").innerText = "Creating bootable media..."
    ElseIf pct < 95 Then
        document.getElementById("progressText").innerText = "Verifying..."
    Else
        document.getElementById("progressText").innerText = "Finishing up..."
    End If
End Sub

Sub ShowComplete()
    On Error Resume Next
    document.getElementById("step2").className = "hidden"
    document.getElementById("step3").className = "progress-section active"
    document.getElementById("completeEdition").innerText = editionName
    document.getElementById("btnFinish").className = "btn btn-primary"
    UpdateDots 4
End Sub

Sub UpdateDots(step)
    Dim dots, i
    On Error Resume Next
    Set dots = document.getElementsByClassName("dot")
    For i = 0 To dots.length - 1
        If i < step - 1 Then
            dots(i).className = "dot done"
        ElseIf i = step - 1 Then
            dots(i).className = "dot active"
        Else
            dots(i).className = "dot"
        End If
    Next
End Sub

Sub CloseApp()
    On Error Resume Next
    window.close
End Sub
</script>
</head>

<body>
<div class="container">
    <div class="header">
        <div class="logo">
            <svg viewBox="0 0 24 24" fill="white">
                <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 2.18l7 3.12v5.7c0 4.83-3.4 9.36-7 10.54-3.6-1.18-7-5.71-7-10.54V6.3l7-3.12z"/>
                <polygon points="12,7 9,12 11,12 11,17 13,17 13,12 15,12"/>
            </svg>
            Aegis OS
        </div>
        <div class="subtitle">Media Creation Tool - Licensed Edition</div>
    </div>

    <div class="content">
        <div class="step-indicator">
            <div class="dot active"></div>
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>

        <div id="step0">
            <div class="section-title">Enter your license key</div>
            <div class="section-desc">Your license key was sent to your email after purchase.</div>
            
            <input type="text" id="licenseInput" class="license-input" placeholder="XXXX-XXXX-XXXX-XXXX" maxlength="19">
        </div>

        <div id="step1" class="hidden">
            <div class="section-title">Select USB flash drive</div>
            
            <div id="licenseValid" class="license-valid"></div>
            
            <div class="section-desc">Choose which drive to use. Everything on it will be deleted.</div>
            
            <div id="driveList" class="drive-list" onclick="DriveListClick()">
                <div class="no-drives">Scanning...</div>
            </div>
            
            <button class="btn btn-link" onclick="RefreshDrives()">Refresh drive list</button>
        </div>

        <div id="step2" class="progress-section">
            <div class="section-title">Creating Aegis OS media</div>
            <div class="section-desc">This might take a while. Please don't remove the USB drive.</div>
            
            <div class="progress-percent" id="progressPercent">0%</div>
            <div class="progress-text" id="progressText">Preparing...</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
        </div>

        <div id="step3" class="progress-section">
            <div style="text-align: center; padding: 20px 0;">
                <div class="complete-icon">&#10004;</div>
                <div class="section-title">Your USB flash drive is ready</div>
                <div class="section-desc">
                    <strong id="completeEdition"></strong> has been installed.
                    <br><br>
                    Restart your PC and press F12, F2, or DEL to boot from USB.
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="disclaimer">Technical Preview. No warranty. Use at your own risk.</div>
        <div>
            <button id="btnValidate" class="btn btn-primary" onclick="ValidateLicense()">Next</button>
            <button id="btnNext" class="btn btn-primary hidden" onclick="StartCreation()" disabled>Next</button>
            <button id="btnFinish" class="hidden" onclick="CloseApp()">Finish</button>
        </div>
    </div>
</div>
</body>
</html>
