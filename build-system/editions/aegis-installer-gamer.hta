<html>
<head>
<title>Aegis OS ISO Downloader - Gamer Edition</title>
<HTA:APPLICATION ID="AegisGamerDownloader" APPLICATIONNAME="Aegis OS Gamer Edition" BORDER="thick" BORDERSTYLE="raised" CAPTION="yes" MAXIMIZEBUTTON="no" MINIMIZEBUTTON="yes" SHOWINTASKBAR="yes" SINGLEINSTANCE="yes" SYSMENU="yes" VERSION="5.0" SCROLL="yes"/>
<style>
body { margin:0; padding:0; font-family:'Segoe UI',Tahoma,Arial,sans-serif; font-size:13px; background:#1a1a2e; color:#eee; }
.header { background:linear-gradient(135deg,#CC0000 0%,#990000 100%); color:white; padding:15px 20px; }
.header h1 { margin:0; font-size:18px; font-weight:600; }
.header .edition { font-size:11px; opacity:0.9; margin-top:2px; }
.content { padding:15px 20px; overflow-y:auto; }
.footer { background:#252540; padding:10px 20px; border-top:1px solid #444; text-align:right; }
.btn { padding:8px 16px; margin-left:6px; border:none; background:#444; color:#fff; font-size:12px; cursor:pointer; border-radius:3px; }
.btn:hover { background:#555; }
.btn-primary { background:#CC0000; font-weight:600; }
.btn-primary:hover { background:#990000; }
.section { background:#252540; border:1px solid #333; border-radius:4px; margin-bottom:12px; padding:12px; }
.section-title { font-weight:600; font-size:13px; margin-bottom:8px; color:#ff4444; }
.progress-container { text-align:center; padding:30px; }
.progress-pct { font-size:48px; font-weight:300; color:#ff4444; }
.progress-bar-bg { background:#333; height:6px; border-radius:3px; margin:15px 0; }
.progress-bar { height:100%; background:#CC0000; border-radius:3px; transition:width 0.3s; }
.progress-status { font-size:13px; color:#ccc; }
.progress-detail { font-size:11px; color:#888; margin-top:4px; }
.success-box { text-align:center; padding:20px; }
.success-icon { font-size:48px; color:#4CAF50; }
.success-title { font-size:16px; font-weight:600; color:#4CAF50; margin:10px 0; }
.info-box { background:#2a2a4a; border:1px solid #CC0000; border-radius:4px; padding:10px; margin:10px 0; font-size:12px; }
.warning-box { background:#3a3020; border:1px solid #FFA000; border-radius:4px; padding:10px; margin:10px 0; font-size:12px; }
.feature-grid { display:flex; flex-wrap:wrap; gap:6px; }
.feature-tag { background:#333; padding:4px 8px; border-radius:3px; font-size:10px; color:#ccc; }
.feature-tag:before { content:"\2713 "; color:#ff4444; }
.checksum { font-family:Consolas; font-size:10px; background:#1a1a2e; padding:6px; border-radius:3px; word-break:break-all; }
.link { color:#66aaff; cursor:pointer; text-decoration:underline; }
</style>
<script language="VBScript">
Dim shell, fso, progressTimer, downloadFolder, currentStep

Sub Window_OnLoad()
    window.resizeTo 580, 550
    Set shell = CreateObject("WScript.Shell")
    Set fso = CreateObject("Scripting.FileSystemObject")
    downloadFolder = shell.ExpandEnvironmentStrings("%USERPROFILE%") & "\Downloads"
    currentStep = 1
    ShowStep 1
End Sub

Sub ShowStep(stepNum)
    document.getElementById("step1").style.display = "none"
    document.getElementById("step2").style.display = "none"
    document.getElementById("step3").style.display = "none"
    document.getElementById("step" & stepNum).style.display = ""
    currentStep = stepNum
End Sub

Sub BrowseFolder()
    Dim folderPath
    Set objShell = CreateObject("Shell.Application")
    Set objFolder = objShell.BrowseForFolder(0, "Select download location:", 0, downloadFolder)
    If Not objFolder Is Nothing Then
        downloadFolder = objFolder.Self.Path
        document.getElementById("folderPath").innerText = downloadFolder
    End If
End Sub

Sub StartDownload()
    Dim tempDir, psFile, progressFile, psCode, ts
    tempDir = shell.ExpandEnvironmentStrings("%TEMP%")
    psFile = tempDir & "\aegis_download.ps1"
    progressFile = tempDir & "\aegis_progress.txt"
    If fso.FileExists(progressFile) Then fso.DeleteFile progressFile
    psCode = GetDownloadScript()
    Set ts = fso.CreateTextFile(psFile, True)
    ts.Write psCode
    ts.Close
    ShowStep 2
    progressTimer = window.setInterval(GetRef("CheckProgress"), 500)
    shell.Run "powershell.exe -ExecutionPolicy Bypass -WindowStyle Hidden -File """ & psFile & """ -DownloadFolder """ & downloadFolder & """ -ProgressFile """ & progressFile & """", 0, False
End Sub

Function GetDownloadScript()
    Dim code
    code = "param([string]$DownloadFolder, [string]$ProgressFile)" & vbCrLf
    code = code & "$ErrorActionPreference = 'Stop'" & vbCrLf
    code = code & "function Write-P { param([int]$P, [string]$S, [string]$D=''); ""$P|$S|$D"" | Out-File $ProgressFile -Encoding UTF8 -Force }" & vbCrLf
    code = code & "try {" & vbCrLf
    code = code & "Write-P 0 'Initializing download...' 'Aegis OS Gamer Edition'" & vbCrLf
    code = code & "$isoPath = Join-Path $DownloadFolder 'AegisOS-Gamer.iso'" & vbCrLf
    code = code & "$mirrors = @('https://repo.linuxliteos.com/linuxlite/isos/7.2/linux-lite-7.2-64bit.iso','https://mirror.freedif.org/LinuxLiteOS/isos/7.2/linux-lite-7.2-64bit.iso')" & vbCrLf
    code = code & "$expectedHash = 'DC8955E02C68537815ED0010F7C4C035CE786BBA2C679DD74532B22205DF8216'" & vbCrLf
    code = code & "Write-P 2 'Connecting to server...' ''" & vbCrLf
    code = code & "$dlSuccess = $false" & vbCrLf
    code = code & "foreach ($url in $mirrors) {" & vbCrLf
    code = code & "  try {" & vbCrLf
    code = code & "    $web = [Net.HttpWebRequest]::Create($url); $web.UserAgent = 'AegisOS/5.0'; $web.Timeout = 30000; $resp = $web.GetResponse(); $total = $resp.ContentLength; $rs = $resp.GetResponseStream(); $fs = [IO.File]::Create($isoPath); $buf = New-Object byte[] 8MB; $dl = 0; $st = Get-Date; $lt = $st" & vbCrLf
    code = code & "    while (($br = $rs.Read($buf, 0, $buf.Length)) -gt 0) {" & vbCrLf
    code = code & "      $fs.Write($buf, 0, $br); $dl += $br; $now = Get-Date" & vbCrLf
    code = code & "      if (($now - $lt).TotalSeconds -ge 0.5) {" & vbCrLf
    code = code & "        $p = [int](($dl / $total) * 100); $el = ($now - $st).TotalSeconds" & vbCrLf
    code = code & "        if ($el -gt 0) { $spd = $dl / $el / 1MB; $rem = ($total - $dl) / ($dl / $el); $eta = [TimeSpan]::FromSeconds([Math]::Max(0,$rem)).ToString('mm\\:ss') }" & vbCrLf
    code = code & "        Write-P ([int]($p * 0.90)) ""Downloading: $p%"" ""$([math]::Round($spd,1)) MB/s - $eta remaining""; $lt = $now" & vbCrLf
    code = code & "      }" & vbCrLf
    code = code & "    }" & vbCrLf
    code = code & "    $fs.Close(); $rs.Close(); $dlSuccess = $true; break" & vbCrLf
    code = code & "  } catch { continue }" & vbCrLf
    code = code & "}" & vbCrLf
    code = code & "if (-not $dlSuccess) { Write-P -1 'ERROR: Download failed' 'Could not connect to download servers'; exit 1 }" & vbCrLf
    code = code & "Write-P 92 'Verifying checksum...' 'This may take a moment'" & vbCrLf
    code = code & "$hash = (Get-FileHash $isoPath -Algorithm SHA256).Hash" & vbCrLf
    code = code & "if ($hash -ne $expectedHash) { Write-P -1 'ERROR: Checksum failed' 'File may be corrupted'; exit 1 }" & vbCrLf
    code = code & "Write-P 100 'SUCCESS' ""$isoPath|$hash""" & vbCrLf
    code = code & "} catch { Write-P -1 ""ERROR: $($_.Exception.Message)"" 'Download failed'; exit 1 }" & vbCrLf
    GetDownloadScript = code
End Function

Sub CheckProgress()
    Dim progressFile, ts, line, parts, pct, status, detail
    progressFile = shell.ExpandEnvironmentStrings("%TEMP%") & "\aegis_progress.txt"
    On Error Resume Next
    If fso.FileExists(progressFile) Then
        Set ts = fso.OpenTextFile(progressFile, 1)
        line = ts.ReadLine()
        ts.Close
        parts = Split(line, "|")
        pct = CInt(parts(0))
        status = parts(1)
        detail = ""
        If UBound(parts) >= 2 Then detail = parts(2)
        If pct = -1 Then
            window.clearInterval progressTimer
            document.getElementById("progressStatus").innerText = status
            document.getElementById("progressDetail").innerText = detail
            document.getElementById("progressPct").innerText = "!"
            document.getElementById("progressBar").style.width = "100%"
            document.getElementById("progressBar").style.background = "#E53935"
        ElseIf pct = 100 Then
            window.clearInterval progressTimer
            Dim successParts
            successParts = Split(detail, "|")
            document.getElementById("isoPath").innerText = successParts(0)
            document.getElementById("isoHash").innerText = successParts(1)
            ShowStep 3
        Else
            document.getElementById("progressPct").innerText = pct & "%"
            document.getElementById("progressBar").style.width = pct & "%"
            document.getElementById("progressStatus").innerText = status
            document.getElementById("progressDetail").innerText = detail
        End If
    End If
    On Error Goto 0
End Sub

Sub OpenFolder()
    shell.Run "explorer.exe """ & downloadFolder & """"
End Sub

Sub OpenEtcher()
    shell.Run "https://etcher.balena.io/"
End Sub

Sub CloseApp()
    window.close
End Sub
</script>
</head>
<body>
<div class="header">
    <h1>Aegis OS Gamer Edition</h1>
    <div class="edition">Ultimate Gaming Experience on Linux</div>
</div>
<div class="content">
    <div id="step1">
        <div class="section">
            <div class="section-title">Included Features</div>
            <div class="feature-grid">
                <span class="feature-tag">Neural Upscaler (ANU)</span>
                <span class="feature-tag">FSR 1.0/2.0/3.0</span>
                <span class="feature-tag">AI Frame Gen</span>
                <span class="feature-tag">Steam/GOG/Epic</span>
                <span class="feature-tag">Proton-GE</span>
                <span class="feature-tag">Wine-GE</span>
                <span class="feature-tag">DXVK/VKD3D</span>
                <span class="feature-tag">GameMode</span>
                <span class="feature-tag">MangoHud</span>
                <span class="feature-tag">GPU OC Tools</span>
                <span class="feature-tag">OBS Studio</span>
                <span class="feature-tag">Instant Replay</span>
                <span class="feature-tag">AI Highlights</span>
                <span class="feature-tag">Twitch/YouTube</span>
                <span class="feature-tag">Controller Support</span>
                <span class="feature-tag">Steam Input</span>
                <span class="feature-tag">Gyro Aiming</span>
                <span class="feature-tag">OpenRGB</span>
                <span class="feature-tag">Fan Control</span>
                <span class="feature-tag">Discord RPC</span>
                <span class="feature-tag">LAN Party Mode</span>
                <span class="feature-tag">Voice Chat</span>
                <span class="feature-tag">Steam Workshop</span>
                <span class="feature-tag">Nexus Mods</span>
                <span class="feature-tag">ReShade</span>
                <span class="feature-tag">Save Manager</span>
                <span class="feature-tag">RetroArch</span>
                <span class="feature-tag">Dolphin</span>
                <span class="feature-tag">PCSX2</span>
                <span class="feature-tag">RPCS3</span>
                <span class="feature-tag">Yuzu</span>
                <span class="feature-tag">Performance Profiles</span>
            </div>
        </div>
        <div class="section">
            <div class="section-title">Download Location</div>
            <p style="font-size:12px;"><strong id="folderPath">C:\Users\...\Downloads</strong></p>
            <button class="btn" onclick="BrowseFolder()">Change Folder</button>
        </div>
        <div class="info-box">
            <strong>Requirements:</strong> ~3 GB disk space, stable internet, 8GB+ USB drive
        </div>
    </div>
    <div id="step2" style="display:none;">
        <div class="section">
            <div class="progress-container">
                <div class="progress-pct" id="progressPct">0%</div>
                <div class="progress-bar-bg"><div class="progress-bar" id="progressBar"></div></div>
                <div class="progress-status" id="progressStatus">Starting download...</div>
                <div class="progress-detail" id="progressDetail"></div>
            </div>
        </div>
        <div class="warning-box">
            <strong>Please wait</strong> - Do not close this window while downloading.
        </div>
    </div>
    <div id="step3" style="display:none;">
        <div class="section">
            <div class="success-box">
                <div class="success-icon">&#10004;</div>
                <div class="success-title">Download Complete!</div>
            </div>
        </div>
        <div class="section">
            <div class="section-title">ISO Location</div>
            <p id="isoPath" class="checksum"></p>
        </div>
        <div class="section">
            <div class="section-title">SHA256 Checksum</div>
            <p id="isoHash" class="checksum"></p>
        </div>
        <div class="section">
            <div class="section-title">Next Steps</div>
            <p style="font-size:12px;">1. Download <span class="link" onclick="OpenEtcher()">Balena Etcher</span> (free)</p>
            <p style="font-size:12px;">2. Open Etcher, select the ISO, select your USB drive</p>
            <p style="font-size:12px;">3. Click "Flash!" to create bootable USB</p>
        </div>
    </div>
</div>
<div class="footer">
    <span id="footerStep1">
        <button class="btn btn-primary" onclick="StartDownload()">Download ISO</button>
    </span>
    <span id="footerStep3" style="display:none;">
        <button class="btn" onclick="OpenFolder()">Open Folder</button>
        <button class="btn btn-primary" onclick="CloseApp()">Done</button>
    </span>
</div>
<script language="VBScript">
Sub ShowStep(stepNum)
    document.getElementById("step1").style.display = "none"
    document.getElementById("step2").style.display = "none"
    document.getElementById("step3").style.display = "none"
    document.getElementById("step" & stepNum).style.display = ""
    document.getElementById("footerStep1").style.display = "none"
    document.getElementById("footerStep3").style.display = "none"
    If stepNum = 1 Then document.getElementById("footerStep1").style.display = ""
    If stepNum = 3 Then document.getElementById("footerStep3").style.display = ""
    currentStep = stepNum
End Sub
</script>
</body>
</html>
