<html>
<head>
<title>Aegis OS - Server Edition</title>
<HTA:APPLICATION ID="Aegis" APPLICATIONNAME="Aegis OS Server" BORDER="thick" BORDERSTYLE="raised" CAPTION="yes" MAXIMIZEBUTTON="no" MINIMIZEBUTTON="yes" SHOWINTASKBAR="yes" SINGLEINSTANCE="yes" SYSMENU="yes" VERSION="1.0" SCROLL="no"/>
<style>
* { box-sizing: border-box; }
body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; background: #f0f0f0; color: #333; }
.header { background: linear-gradient(135deg, #006699, #004D73); color: white; padding: 20px; text-align: center; }
.header h1 { margin: 0 0 5px 0; font-size: 22px; }
.header p { margin: 0; opacity: 0.9; font-size: 13px; }
.content { padding: 20px; }
.section { background: white; border: 1px solid #ddd; border-radius: 6px; padding: 15px; margin-bottom: 15px; }
.section h3 { margin: 0 0 10px 0; color: #006699; font-size: 15px; }
.footer { background: #e0e0e0; padding: 15px 20px; text-align: right; border-top: 1px solid #ccc; }
.btn { padding: 10px 25px; border: 1px solid #aaa; background: white; font-size: 13px; cursor: pointer; border-radius: 4px; margin-left: 10px; }
.btn:hover { background: #f5f5f5; }
.btn-primary { background: #006699; color: white; border-color: #006699; font-weight: bold; }
.btn-primary:hover { background: #004D73; }
.btn:disabled { opacity: 0.6; cursor: not-allowed; }
.progress-box { text-align: center; padding: 30px 0; }
.progress-pct { font-size: 42px; color: #006699; margin-bottom: 10px; }
.progress-bar-bg { background: #ddd; height: 8px; border-radius: 4px; margin: 10px 0; }
.progress-bar { background: #006699; height: 100%; border-radius: 4px; width: 0%; transition: width 0.3s; }
.progress-text { color: #666; font-size: 13px; }
.success { color: #006699; font-size: 20px; }
.error { color: #d32f2f; }
.path { font-family: Consolas, monospace; font-size: 12px; background: #f5f5f5; padding: 8px; border-radius: 4px; word-break: break-all; }
.features { list-style: none; padding: 0; margin: 0; columns: 2; }
.features li { padding: 4px 0 4px 20px; position: relative; font-size: 12px; }
.features li:before { content: "âœ“"; position: absolute; left: 0; color: #006699; font-weight: bold; }
.link { color: #0066cc; cursor: pointer; text-decoration: underline; }
.hidden { display: none; }
</style>
<script language="VBScript">
Option Explicit
Dim oShell, oFSO, sFolder, nTimer

Sub Window_OnLoad()
    window.resizeTo 550, 520
    Set oShell = CreateObject("WScript.Shell")
    Set oFSO = CreateObject("Scripting.FileSystemObject")
    sFolder = oShell.ExpandEnvironmentStrings("%USERPROFILE%") & "\Downloads"
    document.getElementById("folderPath").innerText = sFolder
End Sub

Sub PickFolder()
    Dim oApp, oDir
    Set oApp = CreateObject("Shell.Application")
    Set oDir = oApp.BrowseForFolder(0, "Choose download folder:", 0, sFolder)
    If Not oDir Is Nothing Then
        sFolder = oDir.Self.Path
        document.getElementById("folderPath").innerText = sFolder
    End If
End Sub

Sub BeginDownload()
    Dim sTmp, sPS, sProg, sCode, oFile
    document.getElementById("step1").className = "hidden"
    document.getElementById("step2").className = ""
    document.getElementById("btnStart").disabled = True
    sTmp = oShell.ExpandEnvironmentStrings("%TEMP%")
    sPS = sTmp & "\aegis_dl_" & Timer & ".ps1"
    sProg = sTmp & "\aegis_prog_" & Timer & ".txt"
    sCode = "param($Folder,$ProgFile)" & vbCrLf & "$ErrorActionPreference='Stop'" & vbCrLf & "[Net.ServicePointManager]::SecurityProtocol=[Net.SecurityProtocolType]::Tls12" & vbCrLf & "function WP($p,$s,$d){'$p|$s|$d'|Out-File $ProgFile -Force}" & vbCrLf & "try{WP 0 'Connecting...' '';$iso=$Folder+'\AegisOS-Server.iso';$urls=@('https://repo.linuxliteos.com/linuxlite/isos/7.2/linux-lite-7.2-64bit.iso','https://mirror.freedif.org/LinuxLiteOS/isos/7.2/linux-lite-7.2-64bit.iso');$hash='DC8955E02C68537815ED0010F7C4C035CE786BBA2C679DD74532B22205DF8216';$ok=$false;foreach($u in $urls){try{$r=[Net.HttpWebRequest]::Create($u);$r.Timeout=30000;$rsp=$r.GetResponse();$len=$rsp.ContentLength;$rs=$rsp.GetResponseStream();$fs=[IO.File]::Create($iso);$buf=New-Object byte[] 1MB;$dl=0;$t0=Get-Date;$t1=$t0;while(($n=$rs.Read($buf,0,$buf.Length))-gt 0){$fs.Write($buf,0,$n);$dl+=$n;$now=Get-Date;if(($now-$t1).TotalSeconds -ge 1){$pct=[int]($dl/$len*90);$spd=[math]::Round($dl/($now-$t0).TotalSeconds/1MB,1);WP $pct ('Downloading: '+[int]($dl/$len*100)+'%') ($spd+' MB/s');$t1=$now}};$fs.Close();$rs.Close();$ok=$true;break}catch{continue}};if(-not $ok){WP -1 'ERROR' 'Download failed';exit 1};WP 92 'Verifying...' '';$h=(Get-FileHash $iso SHA256).Hash;if($h -ne $hash){WP -1 'ERROR' 'Checksum mismatch';exit 1};WP 100 'DONE' ($iso+'|'+$h)}catch{WP -1 'ERROR' $_.Exception.Message}"
    Set oFile = oFSO.CreateTextFile(sPS, True)
    oFile.Write sCode
    oFile.Close
    oShell.Run "powershell -EP Bypass -WindowStyle Hidden -File """ & sPS & """ -Folder """ & sFolder & """ -ProgFile """ & sProg & """", 0, False
    nTimer = window.setInterval(GetRef("CheckProg"), 800)
    document.getElementById("progFile").value = sProg
End Sub

Sub CheckProg()
    Dim sFile, oTS, sLine, arr, pct, msg, det, parts
    On Error Resume Next
    sFile = document.getElementById("progFile").value
    If oFSO.FileExists(sFile) Then
        Set oTS = oFSO.OpenTextFile(sFile, 1)
        If Not oTS.AtEndOfStream Then sLine = oTS.ReadLine
        oTS.Close
        If Len(sLine) > 0 Then
            arr = Split(sLine, "|")
            pct = CInt(arr(0))
            msg = arr(1)
            det = ""
            If UBound(arr) >= 2 Then det = arr(2)
            If pct = -1 Then
                window.clearInterval nTimer
                document.getElementById("progressPct").innerText = "!"
                document.getElementById("progressPct").className = "progress-pct error"
                document.getElementById("progressText").innerText = msg & ": " & det
                document.getElementById("btnStart").disabled = False
            ElseIf pct = 100 Then
                window.clearInterval nTimer
                parts = Split(det, "|")
                document.getElementById("isoPath").innerText = parts(0)
                document.getElementById("isoHash").innerText = parts(1)
                document.getElementById("step2").className = "hidden"
                document.getElementById("step3").className = ""
            Else
                document.getElementById("progressPct").innerText = pct & "%"
                document.getElementById("progressBar").style.width = pct & "%"
                document.getElementById("progressText").innerText = msg & " " & det
            End If
        End If
    End If
    On Error Goto 0
End Sub

Sub OpenFolder()
    oShell.Run "explorer """ & sFolder & """"
End Sub

Sub OpenEtcher()
    oShell.Run "https://etcher.balena.io/"
End Sub

Sub CloseWindow()
    If nTimer <> 0 Then window.clearInterval nTimer
    window.close
End Sub
</script>
</head>
<body>
<input type="hidden" id="progFile" value="">
<div class="header">
    <h1>Aegis OS Server Edition</h1>
    <p>Professional Linux Distribution</p>
</div>
<div class="content">
    <div id="step1">
        <div class="section">
            <h3>Included Features</h3>
            <ul class="features">
                <li>AI Security (XDR)</li>
                <li>Load Balancing</li>
                <li>Kubernetes</li>
                <li>Docker Swarm</li>
                <li>Backup Systems</li>
                <li>Disaster Recovery</li>
                <li>SIEM/Logging</li>
                <li>SSL Management</li>
            </ul>
        </div>
        <div class="section">
            <h3>Download Location</h3>
            <p class="path" id="folderPath">Loading...</p>
            <button class="btn" onclick="PickFolder()">Change Folder</button>
        </div>
        <div class="section">
            <h3>Requirements</h3>
            <p>~3 GB disk space, stable internet, 8GB+ USB drive</p>
        </div>
    </div>
    <div id="step2" class="hidden">
        <div class="section">
            <div class="progress-box">
                <div class="progress-pct" id="progressPct">0%</div>
                <div class="progress-bar-bg"><div class="progress-bar" id="progressBar"></div></div>
                <div class="progress-text" id="progressText">Starting download...</div>
            </div>
        </div>
    </div>
    <div id="step3" class="hidden">
        <div class="section" style="text-align:center;">
            <div class="success">&#10004; Download Complete!</div>
        </div>
        <div class="section">
            <h3>ISO File</h3>
            <p class="path" id="isoPath"></p>
        </div>
        <div class="section">
            <h3>SHA256</h3>
            <p class="path" id="isoHash"></p>
        </div>
        <div class="section">
            <h3>Next: Create Bootable USB</h3>
            <p>1. Download <span class="link" onclick="OpenEtcher()">Balena Etcher</span></p>
            <p>2. Select ISO, select USB, click Flash</p>
        </div>
    </div>
</div>
<div class="footer">
    <button class="btn" onclick="CloseWindow()">Cancel</button>
    <button class="btn btn-primary" id="btnStart" onclick="BeginDownload()">Download ISO</button>
</div>
</body>
</html>
